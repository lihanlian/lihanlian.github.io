---
title: 'On Euluer-Lagrange Equation and its application'
date: 2024-06-30
permalink: /posts/2024/06/30
tags:
  - Euler-Largrange Equation
  - Functional Analysis
  - Contrained Optimization
---

_Euler-Lagrange equation_ plays an essential role in calculus of variations and classical mechanics. Beyond its applications in deriving equations of motion, _Euler-Lagrange equation_ is ubiquitous in the filed of _trajectory optimization_, serving as a critical stepping stone for many powerful optimal control techniques, such as [_Pontrygain's Maximum Principle_](https://en.wikipedia.org/wiki/Pontryagin%27s_maximum_principle). In this blog, derivation of the _Euler-Lagrange equation_ and two simple cases of its application are introduced.

## Derivation of Euler-Lagrange Equation
Similar to finding the maximum or minimum of a function, which requires finding the points such that function has zero derivate, the extremal of a functional requries finding the functions that make corresponding [functional dertivate](https://en.wikipedia.org/wiki/Functional_derivative) equal to 0. Let's define the objective functional \\(J\\) that takes \\(q(t)\\), \\(\dot{q}(t)\\) and \\(t\\) as the argument, where \\(q(t)\\) represent generatlized coordinates (i.e. Cartisian, Polar, etc.) and \\(\dot{q}(t)\\) represents the derivative of \\(q(t)\\). 

\\[J = \int_{t_1}^{t_2} L(q(t), \dot{q}(t), t) \, dt \\]

For the seek of concise notation, I will denote \\(q(t)\\) as \\(q\\) and \\(\dot{q}(t)\\) as \\(\dot{q}\\) in the later section, but keep in mind that they are both functions of time. Note that here we are considering the case with **fixed initial and final states and a fixed time interval from \\(t_1\\) to \\(t_2\\)**. Thus, for a optimal functional \\( J^* \\), its functional derivative \\(\frac{\delta J}{\delta q}\\) should be zero. In other word, if we perturb its arguments \\( q^* \\) and \\(q(t)^*\\), the corresponding \\(\delta J\\) should also be zero.

Suppose we perturb \\( q^* \\) by \\(\delta q \\) and \\(\dot{q}^* \\) by \\(\delta \dot{q}\\) respectively, then based on the law of [total derivatives](https://en.wikipedia.org/wiki/Total_derivative#Example:_Differentiation_with_direct_dependencies):

$$\delta J^* = \int_{t_1}^{t_2} \left( \frac{\partial L}{\partial q} \cdot \delta q + \frac{\partial L}{\partial \dot{q}} \cdot \delta \dot{q} \right) dt = 0 
$$

Since \\(\delta \dot{q} \\) is the derivative of \\(\delta q\\), we can express \\(\delta \dot{q} \\) in the form of \\(\delta q\\) through integration by part:

$$
\frac{\partial L}{\partial \dot{q}} \cdot \delta \dot{q} =  \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\vec{q}}} \right)  \cdot \delta q \, +  \cancelto{}{\left[ \frac{\partial L}{\partial \dot{\vec{q}}} \cdot \delta \vec{q} \right]_{t_1}^{t_2}}
$$

Noticed that since both initial state and final state are fixed, and we are dealing with optimization over a fixed time interval, the variation of \\(\delta q\\) should be zero at both time \\(t_1\\) and \\(t_2\\). (\\(\delta q(t_1) = \delta q(t_2) = 0\\)). Therefore, the second term in the above expression vanishes and \\(\delta J^*\\) can be expressed as follows:

$$
\delta J^* = \int_{t_1}^{t_2} \left( \frac{\partial L}{\partial q} - \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q}} \right) \right) \delta q \, dt = 0
$$

Since \\(\delta q\\) can be arbitrary, in order to guarantee \\(\delta J^* = 0\\), the following conditions (Euler-Lagrange Equation) needs to be hold:

$$
\frac{\partial L}{\partial q} - \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q}} \right) = 0
$$

## Euler-Lagrange Equation with Constraints
Let's consider the case where exist [holonomic constraints](https://en.wikipedia.org/wiki/Holonomic_constraints) in the dynamical system. In this case, \\(\delta q\\) can not be arbitrary since relation of \\(f(\delta q) = 0\\) needs to be satified. Introduce an additional degress of freedom \\(\lambda \\) allows us the solve the equations

## Example 1: Get equations of motion for a pendulum.

The Euler-Lagrange Equation is a fundamental component of Lagrangian Mechanics, providing a powerful framework for deriving the equations of motion for various systems. Lagrangian Mechanics is convenient when dealing with forces of constraint and generalized coordinates, as it allows for a more straightforward analysis of these systems. 

Lagrangian Mechanics offers several advantages over Newtonian Mechanics, particularly in its ability to handle more sophisticated systems such as the [acrobot](https://underactuated.mit.edu/acrobot.html) (underactuated [double pendulum](https://en.wikipedia.org/wiki/Double_pendulum#Analysis_and_interpretation)). This approach simplifies the process of obtaining equations of motion by focusing on energy principles rather than forces, making it especially useful for systems with constraints or those that involve complex interactions. Here, we just use the simple pendulum for illustration.

<img src='/images/blog/blog1-fig1.png' style="display: block; margin-left: auto; margin-right: auto; width: 50%;">

Let's consider a massless rod with length \\(l\\) and a ball with mass of \\(m kg\\) attacehd at the end of rod. The Langrangian is defined as the sum of potential engery \\(U\\) and kinetic energy \\(T\\), which are shown as follows:

$$
U = mgy = -mgl \cos \theta, \quad T = \frac{1}{2}m(\dot{x}^2 + \dot{y}^2)
$$

After converting \\(x\\) to \\(\theta\\) use the relations as shown in the picture, the kinetic energy \\(T\\) can be rewritten as:

$$
\dot{x} = \frac{d}{dt}(l \sin \theta) = l \cos \theta \dot{\theta}, \quad \dot{y} = \frac{d}{dt}(l \cos \theta) = -l \sin \theta \dot{\theta}
$$


$$
T = \frac{1}{2}m(l^2 \cos^2 \theta \dot{\theta}^2 + l^2 \sin^2 \theta \dot{\theta}^2) = \frac{1}{2}ml^2 \dot{\theta}^2
$$

Thus the Lagrangian of this simple pendulum system is:

$$
L = T - U = \frac{1}{2}ml^2 \dot{\theta}^2 + mgl \cos \theta
$$

Taking the necessary partial derivatives of Lagrangian,

$$
\frac{\partial L}{\partial \theta} = -mgl \sin \theta, \quad \frac{\partial L}{\partial \dot{\theta}} = ml^2 \dot{\theta},\quad \frac{d}{dt} \frac{\partial L}{\partial \dot{\theta}} = ml^2 \ddot{\theta}
$$

then substitute into Euler-Lagrange Equation,

$$
\frac{\partial L}{\partial \theta} - \frac{d}{dt} \frac{\partial L}{\partial \dot{\theta}} = 0
$$

we  obtained the final equations of motion, which is the same result using Newtonoian approach.

$$
-mgl \sin \theta - ml^2 \ddot{\theta} = 0
$$

After simplifyingt the expression, the dynamics of this simple pendulum can be expressed as

$$
\ddot{\theta} = -\frac{g}{l} \sin \theta, \quad or \quad

\begin{bmatrix}
\dot{\theta} \\
\ddot{\theta}
\end{bmatrix}
=
\begin{bmatrix}
0 & 1 \\
-\frac{g \sin \theta}{l} & 0
\end{bmatrix}
\begin{bmatrix}
\theta \\
\dot{\theta}
\end{bmatrix}.
$$

## Example 2: Solving a simple trajectory optimzation problem

### References
 - [Constrained Lagrangian mechanics: understanding Lagrange multipliers (YouTube)](https://www.youtube.com/watch?v=keMzpa_iWjs) (super excellent and enlightening explanation)
 - [Introduction to Lagrangian Mechanics (YouTube)](https://www.youtube.com/watch?v=8UtnDaGHpq0) (succinct and clear intro with examples)

<!-- - [Deriving the Adjoint Equation for Neural ODEs using Lagrange Multipliers](https://vaipatel.com/posts/deriving-the-adjoint-equation-for-neural-odes-using-lagrange-multipliers/#fn:2)
- [What Is the Adjoint of a Linear System?](https://dsbaero.engin.umich.edu/wp-content/uploads/sites/441/2020/05/Adjoints-21.pdf)(Prof. Omran Kouba and Prof. Dennis S. Bernstein) -->